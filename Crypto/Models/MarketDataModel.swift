//
//  MarketDataModel.swift
//  Crypto
//
//  Created by Kim Insub on 2023/01/14.
//

import Foundation

    // JSON Data:
    /*
     URL: https://api.coingecko.com/api/v3/global
     JSON Response:
     {
       "data": {
         "active_cryptocurrencies": 12627,
         "upcoming_icos": 0,
         "ongoing_icos": 49,
         "ended_icos": 3376,
         "markets": 633,
         "total_market_cap": {
           "btc": 49219931.78162121,
           "eth": 661845543.5681143,
           "ltc": 11423561914.801407,
           "bch": 7955630581.064829,
           "bnb": 3308343980.736894,
           "eos": 962903495925.7092,
           "xrp": 2541665103015.9487,
           "xlm": 11529773271538.178,
           "link": 147141742588.60864,
           "dot": 164830641023.26392,
           "yfi": 138580477.75820142,
           "usd": 1027898490130.5598,
           "aed": 3775501991204.24,
           "ars": 185999172316242.66,
           "aud": 1472207612489.4924,
           "bdt": 107104660560873.66,
           "bhd": 386770448576.8953,
           "bmd": 1027898490130.5598,
           "brl": 5238170705705.312,
           "cad": 1377640951397.4807,
           "chf": 953186716273.9069,
           "clp": 840317294666630.9,
           "cny": 6889900789496.126,
           "czk": 22772988258993.49,
           "dkk": 7059504040367.677,
           "eur": 947502437623.487,
           "gbp": 840404666038.2915,
           "hkd": 8039451065933.614,
           "huf": 376313637236797.25,
           "idr": 1.5765612322567392e+16,
           "ils": 3511198452436.9727,
           "inr": 83552832588009.7,
           "jpy": 131463059992926.39,
           "krw": 1272222085476357.8,
           "kwd": 313601550353.93195,
           "lkr": 376238526638326.44,
           "mmk": 2158746345757160.5,
           "mxn": 19290673754129.168,
           "myr": 4455939954715.967,
           "ngn": 465216577648189.1,
           "nok": 10178148059423.742,
           "nzd": 1609361135926.1033,
           "php": 56458351441012.53,
           "pkr": 235388754239897.7,
           "pln": 4452290915076.004,
           "rub": 70924989651617.48,
           "sar": 3858384530158.942,
           "sek": 10693844731922.262,
           "sgd": 1355695318633.1902,
           "thb": 33702677104186.793,
           "try": 19326033462189.695,
           "twd": 31139876388958.223,
           "uah": 37772931043232.94,
           "vef": 102923475816.77274,
           "vnd": 2.409513705166581e+16,
           "zar": 17278675528532.52,
           "xdr": 764706109631.1182,
           "xag": 42355266535.78782,
           "xau": 535247301.78078204,
           "bits": 49219931781621.21,
           "sats": 4.921993178162121e+15
         },
         "total_volume": {
           "btc": 5155429.8543054415,
           "eth": 69323506.77341148,
           "ltc": 1196535021.6122134,
           "bch": 833294438.3064324,
           "bnb": 346524968.83328474,
           "eos": 100857137546.13759,
           "xrp": 266220932809.73538,
           "xlm": 1207659888705.0095,
           "link": 15412027304.741081,
           "dot": 17264810756.055218,
           "yfi": 14515297.083880078,
           "usd": 107664890449.79387,
           "aed": 395456372568.80536,
           "ars": 19482060440264.9,
           "aud": 154203039346.7171,
           "bdt": 11218434170950.23,
           "bhd": 40511391324.2152,
           "bmd": 107664890449.79387,
           "brl": 548660281732.1473,
           "cad": 144297869425.33603,
           "chf": 99839375552.3407,
           "clp": 88017124591610.67,
           "cny": 721666994195.923,
           "czk": 2385304881426.133,
           "dkk": 739431701120.1398,
           "eur": 99243988708.15356,
           "gbp": 88026276107.29884,
           "hkd": 842074024430.4475,
           "huf": 39416116393669.46,
           "idr": 1.651333220041544e+15,
           "ils": 367772499287.4502,
           "inr": 8751551494365.394,
           "jpy": 13769799341309.78,
           "krw": 133256009981318.75,
           "kwd": 32847481427.327553,
           "lkr": 39408249104794.516,
           "mmk": 226112978135921.03,
           "mxn": 2020557765560.32,
           "myr": 466727300099.85535,
           "ngn": 48728052768672.11,
           "nok": 1066086978744.809,
           "nzd": 168568873344.32355,
           "php": 5913601665180.477,
           "pkr": 24655259913002.742,
           "pln": 466345089738.75867,
           "rub": 7428876795046.413,
           "sar": 404137715680.44403,
           "sek": 1120102454283.4722,
           "sgd": 141999224014.2326,
           "thb": 3530110291169.079,
           "try": 2024261437791.7969,
           "twd": 3261675556709.3657,
           "uah": 3956439786404.1426,
           "vef": 10780485480.737837,
           "vnd": 2523790350845697.5,
           "zar": 1809815585642.7988,
           "xdr": 80097402915.01439,
           "xag": 4436406099.758158,
           "xau": 56063261.75501634,
           "bits": 5155429854305.441,
           "sats": 515542985430544.1
         },
         "market_cap_percentage": {
           "btc": 39.13386569786416,
           "eth": 18.204217432743462,
           "usdt": 6.444896285455265,
           "bnb": 4.9349079638359985,
           "usdc": 4.241872722441677,
           "xrp": 1.9941553242838714,
           "busd": 1.6037172023226984,
           "ada": 1.2394621603393117,
           "doge": 1.1922830733101553,
           "matic": 0.8760284956099774
         },
         "market_cap_change_percentage_24h_usd": 9.170877104072567,
         "updated_at": 1673683744
       }
     }
     */

struct GlobalData: Codable {
    let data: MarketDataModel?
}

struct MarketDataModel: Codable {
    let totalMarketCap, totalVolume, marketCapPercentage: [String: Double]
    let marketCapChangePercentage24HUsd: Double

    var marketCap: String {
        if let item = totalMarketCap.first(where: { $0.key == "usd" }) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }

    var volume: String {
        if let item = totalVolume.first(where: { $0.key == "usd" }) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }

    var btcDominance: String {
        if let item = marketCapPercentage.first(where: { $0.key == "btc" }) { return item.value.asPercentString() }
        return ""
    }
}
